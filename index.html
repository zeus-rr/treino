<!doctype html>
<html lang="pt-BR" class="dark">
<head>
    <link rel="icon" href="https://zeus-rr.github.io/treino/icon.png">
    <link rel="apple-touch-icon" href="https://zeus-rr.github.io/treino/icon.png">
    <link rel="shortcut icon" href="https://zeus-rr.github.io/treino/icon.png">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>TREINO PERSONAL JAQUE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: { 
                extend: { 
                    colors: { 
                        'primary': '#6366f1', 
                        'pink-hot': '#FF1493', 
                        'bg-dark': '#0b0f1a' 
                    } 
                } 
            }
        }
    </script>
    <style>
        .is-conjugated { margin-bottom: -1rem !important; border-bottom-left-radius: 0 !important; border-bottom-right-radius: 0 !important; border-bottom: 2px dashed #FF1493 !important; z-index: 10; }
        .is-conjugated + .workout-item { border-top-left-radius: 0 !important; border-top-right-radius: 0 !important; }
        .is-student-mode .admin-ui, .is-student-mode .edit-btn, .is-student-mode #btnTutorial, .is-student-mode .drag-handle { display: none !important; }
        .is-student-mode main { grid-template-columns: 1fr !important; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #FF1493; border-radius: 10px; }
        
        .category-content { display: none; }
        .category-content.active { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media print { .no-print { display: none !important; } body { background: white !important; color: black !important; } }
        body { transition: background-color 0.3s ease, color 0.3s ease; }
        #tutorialModal { display: none; }
        #tutorialModal.active { display: flex; }
        .pink-bold { color: #FF1493 !important; font-weight: 900 !important; }
        .workout-item.dragging { opacity: 0.4; border: 2px dashed #FF1493; }
        .drag-handle { cursor: grab; padding: 0 10px; color: #64748b; font-size: 1.2rem; display: flex; align-items: center; }

        .btn-whatsapp-float { position: fixed; bottom: 20px; right: 20px; background-color: #25d366; color: white; padding: 12px 20px; border-radius: 50px; font-weight: 900; text-transform: uppercase; font-size: 11px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 8px; z-index: 1000; transition: all 0.3s ease; text-decoration: none; }
        .btn-whatsapp-float:hover { transform: scale(1.05) translateY(-5px); filter: brightness(1.1); }
        
        .category-btn { transition: all 0.2s ease; border-left: 4px solid transparent; }
        .category-btn:hover { background: rgba(255, 20, 147, 0.05); border-left-color: #FF1493; }
        .ex-item { transition: all 0.2s; }
        .ex-item:hover { transform: translateX(5px); }
    </style>
</head>
<body class="bg-slate-100 dark:bg-[#0b0f1a] text-slate-800 dark:text-slate-100 font-sans antialiased flex flex-col min-h-screen">

    <a href="https://api.whatsapp.com/send?phone=5515981776856&text=Oi%20Jaque,%20tenho%20uma%20d√∫vida%20sobre%20o%20meu%20treino!" target="_blank" class="btn-whatsapp-float no-print">
        <span>Falar com a Jaque</span> üí¨
    </a>

    <div id="tutorialModal" class="fixed inset-0 z-[100] bg-slate-900/90 backdrop-blur-sm p-4 items-center justify-center">
        <div class="bg-white dark:bg-slate-900 w-full max-w-2xl max-h-[90vh] rounded-[2.5rem] overflow-hidden flex flex-col shadow-2xl border border-slate-200 dark:border-slate-800">
            <div class="p-6 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center">
                <h2 class="text-xl font-black uppercase italic pink-bold">Guia Prof. Jaque</h2>
                <button onclick="toggleTutorial()" class="text-slate-400 hover:text-red-500 font-bold text-2xl">&times;</button>
            </div>
            <div class="p-8 overflow-y-auto custom-scrollbar space-y-4 text-sm text-slate-600 dark:text-slate-300">
                <p><b>1. Arrastar:</b> Use o √≠cone ‚ò∞ para mudar a ordem dos exerc√≠cios.</p>
                <p><b>2. Duplicar:</b> Clique no √≠cone de c√≥pia üìÑ ao lado do dia para repetir o treino.</p>
                <p><b>3. Encurtar:</b> Use o bot√£o "Encurtar" para gerar um link amig√°vel.</p>
            </div>
            <div class="p-6 text-center">
                <button onclick="toggleTutorial()" class="bg-pink-hot text-white px-8 py-3 rounded-full font-black uppercase text-xs shadow-lg hover:scale-105 transition-all">Entendido!</button>
            </div>
        </div>
    </div>

    <header class="p-4 border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <h1 class="text-xl italic uppercase tracking-tighter pink-bold">PERSONAL _ JAQUE</h1>
            <div class="flex items-center gap-3">
                <div id="studentDisplayHead" class="text-sm font-bold pink-bold hidden sm:block"></div>
                <button id="btnTutorial" onclick="toggleTutorial()" class="bg-slate-100 dark:bg-slate-800 text-slate-500 px-3 py-2 rounded-xl text-[10px] font-black uppercase border border-slate-200 dark:border-slate-700 hover:text-pink-hot">Ajuda ‚ùì</button>
                <button onclick="toggleTheme()" class="p-2 rounded-xl bg-slate-100 dark:bg-slate-800 border border-slate-200 dark:border-slate-700">
                    <span class="dark:hidden">üåô</span>
                    <span class="hidden dark:inline">‚òÄÔ∏è</span>
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto p-4 grid grid-cols-1 lg:grid-cols-12 gap-6 flex-grow w-full">
        <aside class="lg:col-span-4 space-y-4 admin-ui">
            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-xl border border-slate-200 dark:border-slate-800">
                <label class="text-[10px] font-bold uppercase opacity-50 ml-2">Aluno e Dia</label>
                <input type="text" id="studentName" oninput="updateHeader()" placeholder="Nome do Aluno" class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-xl border-none outline-none focus:ring-2 focus:ring-pink-hot mb-3 font-bold">
                <select id="daySelector" class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-xl border-none outline-none focus:ring-2 focus:ring-pink-hot font-bold text-sm">
                    <option value="segunda">Segunda-feira</option>
                    <option value="terca">Ter√ßa-feira</option>
                    <option value="quarta">Quarta-feira</option>
                    <option value="quinta">Quinta-feira</option>
                    <option value="sexta">Sexta-feira</option>
                    <option value="sabado">S√°bado</option>
                </select>
            </div>

            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-xl border border-slate-200 dark:border-slate-800">
                <h3 class="text-xs font-black uppercase mb-4 text-pink-hot tracking-widest">Biblioteca de Exerc√≠cios</h3>
                <input type="text" id="searchEx" placeholder="Buscar exerc√≠cio..." class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-xl mb-4 text-sm outline-none focus:ring-1 focus:ring-pink-hot">
                <div id="accordionLib" class="space-y-2 max-h-[500px] overflow-y-auto pr-2 custom-scrollbar"></div>
            </div>
        </aside>

        <section class="lg:col-span-8 space-y-6">
            <div class="flex flex-wrap gap-2 no-print">
                <button onclick="sendWhatsApp()" class="bg-green-600 text-white px-5 py-3 rounded-full font-black text-[10px] uppercase shadow-lg hover:bg-green-700 transition admin-ui">WhatsApp Aluno üì±</button>
                <button id="btnCopy" onclick="generateLink()" class="bg-pink-hot text-white px-5 py-3 rounded-full font-black text-[10px] uppercase shadow-lg hover:brightness-110 admin-ui">Copiar Link üîó</button>
                <button onclick="shortenLink()" class="bg-blue-600 text-white px-5 py-3 rounded-full font-black text-[10px] uppercase shadow-lg hover:bg-blue-700 admin-ui">Encurtar Link ‚úÇÔ∏è</button>
                <button onclick="window.print()" class="bg-slate-700 text-white px-5 py-3 rounded-full font-black text-[10px] uppercase shadow-lg">Gerar PDF üìÑ</button>
                <button onclick="clearAll()" class="bg-red-500/10 text-red-500 px-5 py-3 rounded-full font-black text-[10px] uppercase admin-ui">Limpar Tudo</button>
            </div>

            <div id="weekDisplay" class="space-y-10"></div>

            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] border border-slate-200 dark:border-slate-800 mt-8">
                <h3 class="text-xs font-black uppercase mb-4 text-pink-hot tracking-widest">Observa√ß√µes Gerais</h3>
                <textarea id="generalNotes" oninput="save()" class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-xl text-sm outline-none focus:ring-1 focus:ring-pink-hot min-h-[120px]" placeholder="Orienta√ß√µes de descanso, carga ou cardio..."></textarea>
            </div>
        </section>
    </main>

    <footer class="mt-auto p-8 text-center border-t border-slate-200 dark:border-slate-800 opacity-60">
        <p class="text-[10px] font-bold uppercase tracking-widest">Desenvolvido por <span class="pink-bold">Rafael Analista de Sistemas</span></p>
    </footer>

    <script>
        const exerciseLibrary = {
            "Peito (Variantes)": ["Supino Reto Barra", "Supino Reto Halteres", "Supino Inclinado Barra", "Supino Inclinado Halteres", "Supino Declinado", "Crucifixo Reto", "Crucifixo Inclinado", "Peck Deck (Voador)", "Crossover Cabo Alto", "Crossover Cabo M√©dio", "Crossover Cabo Baixo", "Flex√£o de Bra√ßos Solo", "Flex√£o Inclinada", "Flex√£o Declinada", "Supino M√°quina Convergente", "Fly no Banco 30¬∫", "Pullover Halter", "Dips (Paralelas) Peito"],
            "Costas (Dorsal/Lombar)": ["Puxada Frente Aberta", "Puxada Tri√¢ngulo", "Puxada Supinada", "Remada Curvada Barra", "Remada Curvada Halteres", "Remada Unilateral (Serrote)", "Remada Baixa Polia", "Remada Cavalinho", "Pulldown Corda", "Barra Fixa Aberta", "Barra Fixa Pegada Inversa", "Levantamento Terra Cl√°ssico", "Terra Sum√¥", "Extens√£o Lombar (Banco Romano)", "Remada M√°quina Articulada", "Face Pull (Posterior Ombro/Costas)", "Remada Alta Barra", "Remada Alta Polia"],
            "Pernas (Quadr√≠ceps)": ["Agachamento Livre Barra", "Agachamento Hack", "Leg Press 45¬∫", "Leg Press Horizontal", "Cadeira Extensora", "Agachamento B√∫lgaro", "Afundo com Halteres", "Passada (Walking Lunges)", "Agachamento Sum√¥", "Agachamento Frontal", "Sissy Squat", "Agachamento na Parede (Isometria)", "Extens√£o de Pernas Unilateral"],
            "Pernas (Posterior/Gl√∫teo)": ["Stiff Barra", "Stiff Halteres", "Mesa Flexora", "Cadeira Flexora", "Flexora Vertical Unilateral", "Eleva√ß√£o P√©lvica Barra", "Eleva√ß√£o P√©lvica M√°quina", "Cadeira Abdutora", "Cadeira Adutora", "Gl√∫teo Quatro Apoios", "Gl√∫teo no Cabo (Coice)", "Good Morning (Bom Dia)", "Levantamento Terra Romeno (RDL)", "Abdu√ß√£o com Caneleiras em Pe", "Abdu√ß√£o Com Caneleira (DL)"],
            "Ombros (Deltoides)": ["Desenvolvimento Militar", "Desenvolvimento Halteres", "Desenvolvimento Arnold", "Eleva√ß√£o Lateral Halteres", "Eleva√ß√£o Lateral Cabo", "Eleva√ß√£o Frontal Barra", "Eleva√ß√£o Frontal Halter", "Crucifixo Inverso Halter", "Crucifixo Inverso M√°quina", "Remada Alta Pegada Aberta", "Encolhimento de Ombros Barra", "Encolhimento Halteres"],
            "Bra√ßos (B√≠ceps)": ["Rosca Direta Barra W", "Rosca Direta Barra Reta", "Rosca Alternada", "Rosca Martelo", "Rosca Scott Barra", "Rosca Scott M√°quina", "Rosca Concentrada", "Rosca Inclinada 45¬∫", "Rosca 21", "Rosca Cross Baixo", "Rosca Inversa Barra", "Rosca Paj√© (Antebra√ßo)"],
            "Bra√ßos (Tr√≠ceps)": ["Tr√≠ceps Pulley V", "Tr√≠ceps Corda", "Tr√≠ceps Testa Barra W", "Tr√≠ceps Franc√™s Halter", "Tr√≠ceps Franc√™s Cabo", "Mergulho no Banco", "Dips (Paralelas) Tr√≠ceps", "Tr√≠ceps Coice Halter", "Tr√≠ceps Coice Cabo", "Supino Pegada Fechada", "Tr√≠ceps Unilateral Inverso"],
            "Panturrilha": ["G√™meos em P√©", "G√™meos Sentado", "G√™meos no Leg Press"],
            "Core e Abs": ["Abdominal Supra Solo", "Abdominal Infra Solo", "Abdominal Infra Suspenso", "Prancha Isom√©trica", "Prancha Lateral", "Russian Twist", "Abdominal Roda", "Abdominal na Polia (Reza)", "Bicicleta no Ar", "V-Sit (Canivete)", "V√°cuo Abdominal"],
            "Exerc√≠cios com Bola (Swiss Ball)": ["Abdominal na Bola", "Infra com Bola", "Ponte na Bola", "Extens√£o Lombar na Bola", "Agachamento com Bola na Parede", "Prancha com Antebra√ßo na Bola", "Passagem de Bola (M√£os para P√©s)"],
            "Equil√≠brio e Estabilidade": ["Equil√≠brio Unipodal (Ch√£o)", "Equil√≠brio no Bosu", "Avi√£ozinho (Propriocep√ß√£o)", "Agachamento no Disco de Equil√≠brio", "Prancha Lateral Din√¢mica", "Passada em Superf√≠cie Inst√°vel"],
            "C√°rdio e Funcional": ["Corrida Esteira", "Bicicleta Ergom√©trica", "Corda Naval", "El√≠ptico (Transport)", "Remo Indoor", "Pular Corda", "Burpees", "Polichinelos", "Mountain Climbers", "Subida no Caixote", "Swing Kettlebell", "Thruster", "Wall Ball"]
        };

        let workoutData = { student: "", generalNotes: "", days: { segunda: [], terca: [], quarta: [], quinta: [], sexta: [], sabado: [] } };

        function init() {
            const savedTheme = localStorage.getItem('theme_jaque') || 'dark';
            document.documentElement.className = savedTheme;
            renderLibrary();
            
            const urlParams = new URLSearchParams(window.location.search);
            const alunoData = urlParams.get('aluno');
            
            if (alunoData) {
                try {
                    const decoded = decodeURIComponent(atob(alunoData).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
                    workoutData = JSON.parse(decoded);
                    document.body.classList.add('is-student-mode');
                } catch(e) { loadFromStorage(); }
            } else {
                loadFromStorage();
            }
            render();
        }

        function renderLibrary() {
            const container = document.getElementById('accordionLib');
            container.innerHTML = "";
            Object.keys(exerciseLibrary).forEach((cat) => {
                const catDiv = document.createElement('div');
                catDiv.className = "mb-3 rounded-2xl border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 overflow-hidden shadow-sm";
                catDiv.innerHTML = `
                    <button onclick="toggleCat(this)" class="category-btn w-full p-4 text-left flex justify-between items-center group">
                        <span class="text-[11px] font-black uppercase tracking-wider text-slate-700 dark:text-slate-300 group-hover:text-pink-hot transition-colors">${cat}</span>
                        <div class="bg-slate-100 dark:bg-slate-800 p-1 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-pink-hot" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7" />
                            </svg>
                        </div>
                    </button>
                    <div class="category-content hidden p-2 space-y-1 border-t border-slate-50 dark:border-slate-800/50">
                        ${exerciseLibrary[cat].map(ex => `
                            <div class="ex-item flex items-center justify-between p-3 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800/50 cursor-pointer group" onclick="addEx('${ex}')">
                                <span class="text-[12px] font-semibold text-slate-600 dark:text-slate-400 group-hover:text-slate-900 dark:group-hover:text-white transition-colors">${ex}</span>
                                <span class="opacity-0 group-hover:opacity-100 bg-pink-hot text-white text-[10px] font-bold px-2 py-1 rounded-lg transition-all shadow-lg shadow-pink-500/30">
                                    + ADD
                                </span>
                            </div>
                        `).join('')}
                    </div>`;
                container.appendChild(catDiv);
            });
        }

        function render() {
            const container = document.getElementById('weekDisplay');
            container.innerHTML = "";
            const isStudent = document.body.classList.contains('is-student-mode');
            
            if(!isStudent) {
                document.getElementById('studentName').value = workoutData.student || "";
                document.getElementById('generalNotes').value = workoutData.generalNotes || "";
            }
            
            document.getElementById('studentDisplayHead').innerText = workoutData.student ? `ALUNO: ${workoutData.student}` : "";
            const dayNames = {segunda: "Segunda-feira", terca: "Ter√ßa-feira", quarta: "Quarta-feira", quinta: "Quinta-feira", sexta: "Sexta-feira", sabado: "S√°bado"};
            
            Object.keys(workoutData.days).forEach(dayKey => {
                const dayTrain = workoutData.days[dayKey];
                if (dayTrain.length === 0) return;

                let html = `<div class="day-section" data-day="${dayKey}">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-black uppercase italic pink-bold flex items-center gap-2">
                            <span class="w-8 h-8 bg-pink-hot text-white rounded-full flex items-center justify-center text-xs not-italic">${dayKey[0].toUpperCase()}</span>
                            ${dayNames[dayKey]}
                        </h2>
                        <button onclick="duplicateDay('${dayKey}')" class="admin-ui bg-slate-100 dark:bg-slate-800 p-2 rounded-lg text-[10px] font-bold hover:text-pink-hot transition-colors">üìÑ DUPLICAR</button>
                    </div>
                    <div class="grid grid-cols-1 gap-3">`;

                dayTrain.forEach((ex, idx) => {
                    html += `
                    <div class="workout-item ${ex.bi ? 'is-conjugated' : ''} bg-white dark:bg-slate-900 p-5 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 flex items-center" 
                         draggable="${!isStudent}" data-index="${idx}"
                         ondragstart="handleDragStart(event)" ondragover="handleDragOver(event)" ondrop="handleDrop(event)">
                        <div class="drag-handle admin-ui">‚ò∞</div>
                        <div class="flex-1">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h4 class="font-bold text-sm uppercase tracking-tight">${ex.n}</h4>
                                    <input type="text" value="${ex.obs || ''}" oninput="workoutData.days['${dayKey}'][${idx}].obs=this.value;save()" class="w-full mt-2 bg-transparent border-b border-dashed border-slate-300 dark:border-slate-700 text-[10px] outline-none italic" placeholder="Instru√ß√£o..." ${isStudent ? 'disabled' : ''}>
                                    <div class="flex gap-2 mt-3 no-print">
                                        <button onclick="toggleBi('${dayKey}', ${idx})" class="edit-btn text-[8px] font-black px-3 py-1.5 rounded-full ${ex.bi ? 'bg-pink-hot text-white' : 'bg-slate-100 dark:bg-slate-800'}">CONJUGADO</button>
                                        <button onclick="removeEx('${dayKey}', ${idx})" class="edit-btn text-[8px] font-black px-3 py-1.5 rounded-full bg-red-500/10 text-red-500">REMOVER</button>
                                    </div>
                                </div>
                                <div class="flex gap-4 ml-4">
                                    <div class="flex flex-col items-center">
                                        <span class="text-[7px] font-black opacity-40 mb-1 uppercase">S√©ries</span>
                                        <input type="text" value="${ex.r}" oninput="workoutData.days['${dayKey}'][${idx}].r=this.value;save()" class="w-16 bg-slate-100 dark:bg-slate-800 text-center font-bold text-xs p-2 rounded-xl outline-none" ${isStudent ? 'disabled' : ''}>
                                    </div>
                                    <div class="flex flex-col items-center">
                                        <span class="text-[7px] font-black opacity-40 mb-1 uppercase">Carga</span>
                                        <input type="text" value="${ex.w}" oninput="workoutData.days['${dayKey}'][${idx}].w=this.value;save()" class="w-14 bg-slate-100 dark:bg-slate-800 text-center font-bold text-xs p-2 rounded-xl outline-none" ${isStudent ? 'disabled' : ''}>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`;
                });
                html += `</div></div>`;
                container.innerHTML += html;
            });
        }

        let dragSrcIndex = null, dragSrcDay = null;
        function handleDragStart(e) { dragSrcIndex = e.currentTarget.dataset.index; dragSrcDay = e.currentTarget.closest('.day-section').dataset.day; }
        function handleDragOver(e) { e.preventDefault(); }
        function handleDrop(e) {
            const targetDay = e.currentTarget.closest('.day-section').dataset.day;
            const targetIndex = e.currentTarget.dataset.index;
            if (dragSrcDay === targetDay) {
                const item = workoutData.days[dragSrcDay].splice(dragSrcIndex, 1)[0];
                workoutData.days[dragSrcDay].splice(targetIndex, 0, item);
                save(); render();
            }
        }

        function duplicateDay(fromDay) {
            const promptDay = prompt("Para qual dia copiar? (segunda, terca, quarta, quinta, sexta, sabado)");
            if(!promptDay) return;
            const toDay = promptDay.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace("-feira", "");
            if(workoutData.days[toDay]) { workoutData.days[toDay] = JSON.parse(JSON.stringify(workoutData.days[fromDay])); save(); render(); }
        }

        function addEx(name) { const day = document.getElementById('daySelector').value; workoutData.days[day].push({ n: name, r: "3x12", w: "", obs: "", bi: false }); save(); render(); }
        function save() { if(document.body.classList.contains('is-student-mode')) return; workoutData.student = document.getElementById('studentName').value; workoutData.generalNotes = document.getElementById('generalNotes').value; localStorage.setItem('jaque_pro_v2', JSON.stringify(workoutData)); }
        function loadFromStorage() { const saved = localStorage.getItem('jaque_pro_v2'); if(saved) workoutData = JSON.parse(saved); }
        function toggleCat(btn) { btn.nextElementSibling.classList.toggle('active'); }
        function toggleTutorial() { document.getElementById('tutorialModal').classList.toggle('active'); }
        function toggleTheme() { document.documentElement.classList.toggle('dark'); localStorage.setItem('theme_jaque', document.documentElement.classList.contains('dark') ? 'dark' : 'light'); }
        function toggleBi(day, idx) { workoutData.days[day][idx].bi = !workoutData.days[day][idx].bi; save(); render(); }
        function removeEx(day, idx) { if(confirm("Remover exerc√≠cio?")) { workoutData.days[day].splice(idx, 1); save(); render(); } }
        function updateHeader() { document.getElementById('studentDisplayHead').innerText = `ALUNO: ${document.getElementById('studentName').value}`; save(); }
        function clearAll() { if(confirm("Limpar tudo?")) { localStorage.removeItem('jaque_pro_v2'); location.reload(); } }

        function getGeneratedURL() {
            const jsonStr = JSON.stringify(workoutData);
            const encoded = btoa(encodeURIComponent(jsonStr).replace(/%([0-9A-F]{2})/g, (match, p1) => String.fromCharCode('0x' + p1)));
            return `${window.location.origin}${window.location.pathname}?aluno=${encoded}`;
        }

        function generateLink() {
            navigator.clipboard.writeText(getGeneratedURL()).then(() => {
                const btn = document.getElementById('btnCopy');
                btn.innerText = "COPIADO! ‚úÖ";
                setTimeout(() => btn.innerText = "Copiar Link üîó", 2000);
            });
        }

        function sendWhatsApp() {
            const text = encodeURIComponent(`Ol√° ${workoutData.student || 'Aluno'}, aqui est√° seu treino: ${getGeneratedURL()}`);
            window.open(`https://api.whatsapp.com/send?text=${text}`, '_blank');
        }

        function shortenLink() { window.open(`https://abre.ai/index.php?a=shorten&url=${encodeURIComponent(getGeneratedURL())}`, '_blank'); }

        document.getElementById('searchEx').addEventListener('input', function(e) {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('#accordionLib .category-content').forEach(cat => {
                let hasMatch = false;
                cat.querySelectorAll('.ex-item').forEach(el => {
                    const match = el.innerText.toLowerCase().includes(term);
                    el.style.display = match ? 'flex' : 'none';
                    if(match) hasMatch = true;
                });
                if(term.length > 1 && hasMatch) cat.classList.add('active');
                else if(term.length <= 1) cat.classList.remove('active');
            });
        });

        window.onload = init;
    </script>
</body>
</html>
