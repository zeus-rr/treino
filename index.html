<!doctype html>
<html lang="pt-BR" class="dark">
<head>
    <link rel="icon" href="https://zeus-rr.github.io/treino/icon.png">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title id="pageTitle">SISTEMA DE TREINO PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // --- TRAVA DE SEGURAN√áA E REDIRECIONAMENTO ---
        (function() {
            const urlParams = new URLSearchParams(window.location.search);
            const isStudent = urlParams.has('aluno');
            const isProf = urlParams.has('auth');

            if (!isStudent && !isProf) {
                // Bloqueia o carregamento e mostra aviso
                document.documentElement.innerHTML = `
                <body style="background:#0b0f1a; color:white; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center; font-family:sans-serif; text-align:center;">
                    <img src="https://zeus-rr.github.io/treino/icon.png" style="width:80px; margin-bottom:20px;">
                    <h1 style="color:#FF1493; font-weight:900;">ACESSO RESTRITO</h1>
                    <p style="opacity:0.7;">Fa√ßa login no Painel Administrativo para continuar.</p>
                    <a href="admin.html" style="margin-top:20px; background:#FF1493; color:white; padding:12px 25px; border-radius:10px; text-decoration:none; font-weight:bold; text-transform:uppercase; font-size:12px;">Ir para Login</a>
                </body>`;
                window.stop(); 
            }
        })();

        tailwind.config = {
            darkMode: 'class', 
            theme: { 
                extend: { 
                    colors: { 
                        'pink-hot': 'var(--main-color, #FF1493)', 
                        'bg-dark': '#0b0f1a' 
                    } 
                } 
            }
        }
    </script>
    <style>
        :root { --main-color: #FF1493; }
        .is-conjugated { margin-bottom: -1rem !important; border-bottom-left-radius: 0 !important; border-bottom-right-radius: 0 !important; border-bottom: 2px dashed var(--main-color) !important; z-index: 10; }
        .is-conjugated + .workout-item { border-top-left-radius: 0 !important; border-top-right-radius: 0 !important; }
        .is-student-mode .admin-ui, .is-student-mode .edit-btn, .is-student-mode .drag-handle { display: none !important; }
        
        /* Checkbox de S√©ries Estilizado */
        .serie-dot { width: 24px; height: 24px; border: 2px solid var(--main-color); border-radius: 50%; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; }
        .serie-dot.checked { background-color: var(--main-color); color: white; transform: scale(1.1); }
        
        .progress-bar-container { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: rgba(255,20,147,0.1); z-index: 1000; }
        #progressFill { height: 100%; background: var(--main-color); width: 0%; transition: width 0.3s ease; box-shadow: 0 0 10px var(--main-color); }

        .pink-bold { color: var(--main-color) !important; font-weight: 900 !important; }
        .btn-whatsapp-float { position: fixed; bottom: 20px; right: 20px; background-color: #25d366; color: white; padding: 8px 16px; border-radius: 50px; font-weight: 800; text-transform: uppercase; font-size: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 10px; z-index: 1000; transition: all 0.3s ease; text-decoration: none; border: 2px solid white; }
        .btn-whatsapp-float img { width: 30px; height: 30px; border-radius: 50%; object-fit: cover; background: white; }
        .category-content { display: none; }
        .category-content.active { display: block; animation: slideDown 0.3s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .exercise-added { animation: added-pulse 0.6s ease-out; border-color: #22c55e !important; }
        @keyframes added-pulse { 0% { background-color: transparent; } 50% { background-color: rgba(34, 197, 94, 0.2); transform: scale(1.02); } 100% { background-color: transparent; } }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: var(--main-color); border-radius: 10px; }
        .drag-handle { cursor: grab; padding: 0 10px; color: #64748b; font-size: 1.2rem; }
    </style>
</head>
<body class="bg-slate-100 dark:bg-[#0b0f1a] text-slate-800 dark:text-slate-100 font-sans min-h-screen">

    <div id="progressContainer" class="progress-bar-container hidden"><div id="progressFill"></div></div>

    <a id="waFloat" href="#" target="_blank" class="btn-whatsapp-float no-print">
        <img id="waPhoto" src="https://zeus-rr.github.io/treino/icon.png">
        <span id="waText">Falar com Professor</span>
    </a>

    <header class="p-4 border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/80 backdrop-blur-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <img id="displayImgProf" src="https://zeus-rr.github.io/treino/icon.png" class="w-10 h-10 rounded-full border-2 border-pink-hot object-cover shadow-lg">
                <h1 id="brandName" class="text-xl italic uppercase tracking-tighter pink-bold">SISTEMA ZEUS</h1>
            </div>
            <div class="flex items-center gap-3">
                <div class="flex items-center gap-2">
                    <img id="displayImgAluno" src="" class="w-9 h-9 rounded-full object-cover hidden border-2 border-slate-300 shadow-sm">
                    <div id="studentDisplayHead" class="text-sm font-bold pink-bold hidden sm:block"></div>
                </div>
                <button onclick="toggleTheme()" class="p-2 rounded-xl bg-slate-100 dark:bg-slate-800 border">üåì</button>
                <button onclick="window.location.href='admin.html'" class="admin-ui p-2 px-3 rounded-xl bg-red-500/10 text-red-500 text-[10px] font-black border border-red-500/20">SAIR</button>
            </div>
        </div>
    </header>

    <main class="max-w-[1600px] mx-auto p-4 grid grid-cols-1 lg:grid-cols-12 gap-6 w-full">
        <aside class="lg:col-span-4 space-y-4 admin-ui">
            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-xl border border-pink-hot/20">
                <h3 class="text-[10px] font-black uppercase mb-4 text-pink-hot tracking-widest">Configura√ß√µes Ativas</h3>
                <div class="space-y-3">
                    <input type="text" id="confName" oninput="updateConfigs()" placeholder="Nome da Marca" class="w-full bg-slate-100 dark:bg-slate-800 p-2 rounded-lg text-sm font-bold outline-none border-b-2 border-pink-hot">
                    <input type="text" id="confPhone" oninput="updateConfigs()" placeholder="WhatsApp (Ex: 55159...)" class="w-full bg-slate-100 dark:bg-slate-800 p-2 rounded-lg text-sm font-bold outline-none">
                    
                    <div class="space-y-2 py-2">
                        <label class="text-[9px] font-bold uppercase opacity-60 ml-1">URLs das Imagens</label>
                        <input type="url" id="urlProf" oninput="handleURLImage(this, 'prof')" placeholder="Link Foto Professor" class="w-full bg-slate-100 dark:bg-slate-800 p-2 rounded-lg text-[10px] font-bold outline-none border-b border-pink-hot/30">
                        <input type="url" id="urlAluno" oninput="handleURLImage(this, 'student')" placeholder="Link Foto Aluno" class="w-full bg-slate-100 dark:bg-slate-800 p-2 rounded-lg text-[10px] font-bold outline-none border-b border-pink-hot/30">
                    </div>

                    <div class="flex items-center justify-between bg-slate-100 dark:bg-slate-800 p-2 rounded-lg">
                        <label class="text-[10px] font-bold uppercase opacity-50">Cor do Tema</label>
                        <input type="color" id="confColor" oninput="updateConfigs()" class="w-10 h-6 bg-transparent cursor-pointer">
                    </div>
                </div>
            </div>

            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-xl border border-slate-200 dark:border-slate-800">
                <h3 class="text-[10px] font-black uppercase mb-4 text-pink-hot tracking-widest">Hist√≥rico de Treinos</h3>
                <div class="flex gap-2 mb-4">
                    <button onclick="saveToHistory()" class="flex-1 bg-pink-hot text-white text-[9px] font-bold p-2 rounded-lg uppercase">Salvar Atual</button>
                </div>
                <div id="historyList" class="space-y-2 max-h-40 overflow-y-auto custom-scrollbar"></div>
            </div>

            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-xl border border-slate-200 dark:border-slate-800">
                <label class="text-[10px] font-bold uppercase opacity-50 ml-2">Dados do Aluno</label>
                <input type="text" id="studentName" oninput="updateHeader()" placeholder="Nome do Aluno" class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-xl mb-3 font-bold outline-none">
                <select id="daySelector" class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-xl font-bold text-sm outline-none">
                    <option value="segunda">Segunda-feira</option>
                    <option value="terca">Ter√ßa-feira</option>
                    <option value="quarta">Quarta-feira</option>
                    <option value="quinta">Quinta-feira</option>
                    <option value="sexta">Sexta-feira</option>
                    <option value="sabado">S√°bado</option>
                </select>
            </div>

            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-xl border border-slate-200 dark:border-slate-800">
                <h3 class="text-xs font-black uppercase mb-4 text-pink-hot tracking-widest">Biblioteca de Exerc√≠cios</h3>
                <input type="text" id="searchEx" placeholder="Buscar exerc√≠cio..." class="w-full bg-slate-100 dark:bg-slate-800 p-3 rounded-xl mb-4 text-sm outline-none">
                <div id="accordionLib" class="space-y-2 max-h-[450px] overflow-y-auto pr-2 custom-scrollbar"></div>
            </div>
        </aside>

        <section class="lg:col-span-8 space-y-6">
            <div class="flex flex-wrap gap-2 no-print">
                <button onclick="sendWhatsApp()" class="bg-green-600 text-white px-5 py-3 rounded-full font-black text-[10px] uppercase shadow-lg admin-ui">Enviar p/ Aluno üì±</button>
                <button id="btnCopy" onclick="generateLink()" class="bg-pink-hot text-white px-5 py-3 rounded-full font-black text-[10px] uppercase shadow-lg admin-ui">Copiar Link üîó</button>
                <button onclick="shortenLinkWithName()" class="bg-blue-600 text-white px-5 py-3 rounded-full font-black text-[10px] uppercase shadow-lg admin-ui">Encurtar Link ‚úÇÔ∏è</button>
                <button onclick="window.print()" class="bg-slate-700 text-white px-5 py-3 rounded-full font-black text-[10px] uppercase shadow-lg">PDF üìÑ</button>
                <button onclick="clearAll()" class="bg-red-500/10 text-red-500 px-5 py-3 rounded-full font-black text-[10px] uppercase admin-ui">Limpar Tudo</button>
            </div>

            <div id="weekDisplay" class="space-y-10"></div>

            <div id="finishArea" class="hidden text-center p-10 bg-white dark:bg-slate-900 rounded-[2rem] border-2 border-dashed border-pink-hot">
                <h2 class="text-2xl font-black text-pink-hot mb-2">TREINO CONCLU√çDO! üî•</h2>
                <p class="text-sm opacity-70">Foco mantido. At√© amanh√£!</p>
                <button onclick="location.reload()" class="mt-4 bg-pink-hot text-white px-6 py-2 rounded-full font-bold text-xs">REINICIAR</button>
            </div>

            <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] border border-slate-200 dark:border-slate-800">
                <h3 class="text-xs font-black uppercase mb-4 text-pink-hot tracking-widest">Observa√ß√µes Gerais</h3>
                <textarea id="generalNotes" oninput="save()" class="w-full bg-slate-100 dark:bg-slate-800 p-4 rounded-xl text-sm outline-none min-h-[100px]" placeholder="Dicas de cardio, descanso..."></textarea>
            </div>
        </section>
    </main>

    <script>
       const exerciseLibrary = {
            "Peito (Variantes)": ["Supino Reto Barra", "Supino Reto M√°quina", "Supino Reto Halteres", "Supino Inclinado Barra", "Supino Inclinado M√°quina", "Supino Inclinado Halteres", "Supino Declinado", "Supino Pegada Fechada", "Supino Horizontal", "Crucifixo Reto", "Crucifixo Inclinado", "Peck Deck (Voador)", "Crossover Cabo Alto", "Crossover Cabo M√©dio", "Crossover Cabo Baixo", "Flex√£o de Bra√ßos Solo", "Supino M√°quina Convergente", "Fly no Banco 30¬∫", "Pullover Halter", "Dips (Paralelas) Peito"],
            "Costas (Dorsal/Lombar)": ["Puxada Frente Aberta", "Puxada Tri√¢ngulo", "Puxada Supinada", "Remada Curvada Barra", "Remada Curvada Halteres", "Remada Unilateral (Serrote)", "Remada Baixa Polia", "Remada Cavalinho", "Pulldown Corda", "Barra Fixa Aberta", "Levantamento Terra Cl√°ssico", "Extens√£o Lombar", "Remada M√°quina Articulada", "Face Pull"],
            "Pernas (Quadr√≠ceps)": ["Agachamento Livre Barra", "Agachamento Hack", "Leg Press 45¬∫", "Leg Press Horizontal", "Cadeira Extensora", "Agachamento B√∫lgaro", "Afundo com Halteres", "Passada (Walking Lunges)", "Agachamento Sum√¥", "Adu√ß√£o Cabo", "Recuo", "A fundo no Step", "Sissy Squat"],
            "Pernas (Posterior/Gl√∫teo)": ["Stiff Barra", "Stiff Halteres", "Mesa Flexora", "Cadeira Flexora", "Eleva√ß√£o P√©lvica Barra", "Cadeira Abdutora", "Cadeira Adutora", "Gl√∫teo no Cabo (Coice)", "Gl√∫teo no Cabo Extens√£o", "Levantamento Terra", "Levantamento Terra Sum√¥", "Flex√£o Joelho M√°quina", "A fundo com o Step atr√°s", "A fundo com Dois Step", "B√∫lgaro com Step", "Abdu√ß√£o DL", "Flex√£o de Joelho Caneleira", "Flex√£o Joelho Bola", "Abdu√ß√£o com Caneleiras"],
            "Ombros (Deltoides)": ["Desenvolvimento Militar", "Desenvolvimento Halteres", "Desenvolvimento Arnold", "Eleva√ß√£o Lateral Halteres", "Eleva√ß√£o Lateral Cabo", "Eleva√ß√£o Frontal Barra", "Crucifixo Inverso Halter", "Encolhimento de Ombros"],
            "Bra√ßos (B√≠ceps)": ["Rosca Direta Barra W", "Rosca Alternada", "Rosca Martelo", "Rosca Scott Barra", "Rosca Concentrada", "Rosca Inclinada 45¬∫", "Rosca Cross Baixo", "Rosca Inversa Barra"],
            "Bra√ßos (Tr√≠ceps)": ["Tr√≠ceps Pulley V", "Tr√≠ceps Corda", "Tr√≠ceps Testa Barra W", "Tr√≠ceps Franc√™s Halter", "Mergulho no Banco", "Dips (Paralelas) Tr√≠ceps", "Tr√≠ceps Coice Halter", "Supino Pegada Fechada"],
            "Panturrilha": ["G√™meos em P√©", "G√™meos Sentado", "G√™meos no Leg Press"],
            "Core e Abs": ["Abdominal Supra Solo", "Abdominal Infra Solo", "Prancha Isom√©trica", "Prancha Lateral", "Abdominal Roda", "Abdominal na Polia", "V-Sit (Canivete)", "Abdominal  Remador", " Perdigueiro", "Abdominal Supra com Bola", "Infra com Bola", "V√°cuo Abdominal"],
            "C√°rdio e Funcional": ["Corrida Esteira", "Cardio", "Caminhada na Esteira ", "Hit", "Bicicleta Ergom√©trica", "Corda Naval", "El√≠ptico", "Pular Corda", "Burpees", "Polichinelos", "Mountain Climbers", "Corrida no mesmo lugar", "Sobe e Desce no Step", "Swing Kettlebell"]
        };

        let workoutData = { 
            student: "", generalNotes: "", photoProf: "https://zeus-rr.github.io/treino/icon.png", photoStudent: "",
            profName: "SISTEMA ZEUS", profPhone: "5500000000000", themeColor: "#FF1493",
            days: { segunda: [], terca: [], quarta: [], quinta: [], sexta: [], sabado: [] } 
        };

        function init() {
            renderLibrary();
            const urlParams = new URLSearchParams(window.location.search);
            const alunoData = urlParams.get('aluno');
            const authProf = urlParams.get('auth');

            // --- L√ìGICA DE LOGIN DO PROFESSOR (Vindo do admin.html) ---
            if (authProf) {
                try {
                    const prof = JSON.parse(atob(authProf));
                    // Captura os dados do professor do LocalStorage para preencher o treino
                    const staff = JSON.parse(localStorage.getItem('staff_data')) || [];
                    const profFull = staff.find(p => p.id === prof.id);
                    
                    if(profFull) {
                        workoutData.profName = profFull.name;
                        workoutData.photoProf = profFull.photo;
                        workoutData.themeColor = profFull.color;
                        applyConfigs();
                    }
                } catch(e) { console.error("Erro na auth prof"); }
            }

            if (alunoData) {
                try {
                    const decoded = decodeURIComponent(atob(alunoData).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
                    workoutData = JSON.parse(decoded);
                    document.body.classList.add('is-student-mode');
                    document.getElementById('progressContainer').classList.remove('hidden');
                } catch(e) { loadFromStorage(); }
            } else { 
                loadFromStorage();
                renderHistory();
            }
            applyConfigs();
            render();
        }

        // --- FUN√á√ïES DE HIST√ìRICO ---
        function saveToHistory() {
            if(!workoutData.student) return alert("D√™ um nome ao aluno antes de salvar.");
            let history = JSON.parse(localStorage.getItem('jaque_history') || '[]');
            const entry = {
                id: Date.now(),
                name: workoutData.student,
                date: new Date().toLocaleDateString(),
                data: JSON.parse(JSON.stringify(workoutData))
            };
            history.unshift(entry);
            localStorage.setItem('jaque_history', JSON.stringify(history));
            renderHistory();
            alert("Treino salvo!");
        }

        function renderHistory() {
            const historyList = document.getElementById('historyList');
            if(!historyList) return;
            let history = JSON.parse(localStorage.getItem('jaque_history') || '[]');
            historyList.innerHTML = history.length ? "" : "<p class='text-[9px] opacity-40 text-center'>Nenhum treino salvo</p>";
            history.forEach(item => {
                historyList.innerHTML += `
                    <div class="flex items-center justify-between bg-slate-100 dark:bg-slate-800 p-2 rounded-lg border border-slate-200 dark:border-slate-700">
                        <div class="cursor-pointer flex-1" onclick="loadHistoryItem(${item.id})">
                            <p class="text-[10px] font-bold uppercase">${item.name}</p>
                            <p class="text-[8px] opacity-50">${item.date}</p>
                        </div>
                        <button onclick="deleteHistoryItem(${item.id})" class="text-red-500 text-[10px] px-2">‚úï</button>
                    </div>
                `;
            });
        }

        function loadHistoryItem(id) {
            if(!confirm("Carregar este treino?")) return;
            let history = JSON.parse(localStorage.getItem('jaque_history') || '[]');
            const item = history.find(i => i.id === id);
            if(item) {
                workoutData = JSON.parse(JSON.stringify(item.data));
                applyConfigs();
                render();
                save();
            }
        }

        function deleteHistoryItem(id) {
            let history = JSON.parse(localStorage.getItem('jaque_history') || '[]');
            history = history.filter(i => i.id !== id);
            localStorage.setItem('jaque_history', JSON.stringify(history));
            renderHistory();
        }

        // --- FUNCIONALIDADES DO TREINO ---
        function toggleCheck(el) { el.classList.toggle('checked'); updateProgress(); }
        function updateProgress() {
            const dots = document.querySelectorAll('.serie-dot');
            if(!dots.length) return;
            const checked = document.querySelectorAll('.serie-dot.checked');
            const pct = (checked.length / dots.length) * 100;
            document.getElementById('progressFill').style.width = pct + '%';
            if(pct === 100) document.getElementById('finishArea').classList.remove('hidden');
        }

        function applyConfigs() {
            document.documentElement.style.setProperty('--main-color', workoutData.themeColor);
            document.getElementById('brandName').innerText = workoutData.profName;
            document.getElementById('confName').value = workoutData.profName;
            document.getElementById('confPhone').value = workoutData.profPhone;
            document.getElementById('confColor').value = workoutData.themeColor;
            document.getElementById('urlProf').value = workoutData.photoProf || "";
            document.getElementById('urlAluno').value = workoutData.photoStudent || "";
            const firstName = workoutData.profName.split(' ')[0];
            document.getElementById('waText').innerText = `Falar com ${firstName}`;
            document.getElementById('waFloat').href = `https://api.whatsapp.com/send?phone=${workoutData.profPhone}&text=Oi ${firstName}, tenho uma d√∫vida!`;
            if(workoutData.photoProf) {
                document.getElementById('displayImgProf').src = workoutData.photoProf;
                document.getElementById('waPhoto').src = workoutData.photoProf;
            }
        }

        function updateConfigs() {
            workoutData.profName = document.getElementById('confName').value;
            workoutData.profPhone = document.getElementById('confPhone').value;
            workoutData.themeColor = document.getElementById('confColor').value;
            applyConfigs(); save();
        }

        function handleURLImage(input, type) {
            const url = input.value.trim();
            if (type === 'prof') workoutData.photoProf = url;
            else workoutData.photoStudent = url;
            applyConfigs(); save(); render();
        }

        function addEx(name, el) {
            const day = document.getElementById('daySelector').value;
            workoutData.days[day].push({ n: name, r: "3x12", w: "", obs: "", bi: false });
            el.classList.add('exercise-added');
            setTimeout(() => el.classList.remove('exercise-added'), 600);
            save(); render();
        }

        function render() {
            const container = document.getElementById('weekDisplay');
            container.innerHTML = "";
            const isStudent = document.body.classList.contains('is-student-mode');
            
            if(!isStudent) {
                document.getElementById('studentName').value = workoutData.student || "";
                document.getElementById('generalNotes').value = workoutData.generalNotes || "";
            }
            
            const studentImg = document.getElementById('displayImgAluno');
            if (workoutData.photoStudent) {
                studentImg.src = workoutData.photoStudent;
                studentImg.classList.remove('hidden');
            }
            document.getElementById('studentDisplayHead').innerText = workoutData.student ? `ALUNO: ${workoutData.student}` : "";

            Object.keys(workoutData.days).forEach(dayKey => {
                if (workoutData.days[dayKey].length === 0) return;
                let html = `<div class="day-section" data-day="${dayKey}">
                    <h2 class="text-xl font-black uppercase italic pink-bold mb-4 flex items-center justify-between">
                        ${dayKey}
                        <button onclick="duplicateDay('${dayKey}')" class="admin-ui text-[10px] bg-slate-200 dark:bg-slate-800 px-3 py-1 rounded-full not-italic">DUPLICAR</button>
                    </h2>
                    <div class="grid gap-3">`;
                workoutData.days[dayKey].forEach((ex, idx) => {
                    let numSeries = parseInt(ex.r.split('x')[0]) || 0;
                    let checklistHtml = "";
                    if(isStudent && numSeries > 0 && numSeries < 11) {
                        checklistHtml = `<div class="flex gap-2 mt-3 flex-wrap">`;
                        for(let i=1; i<=numSeries; i++) checklistHtml += `<div class="serie-dot" onclick="toggleCheck(this)">${i}</div>`;
                        checklistHtml += `</div>`;
                    }

                    html += `
                    <div class="workout-item ${ex.bi ? 'is-conjugated' : ''} bg-white dark:bg-slate-900 p-4 rounded-[1.5rem] shadow-sm border border-slate-200 dark:border-slate-800 flex flex-col">
                        <div class="flex items-center w-full">
                            <div class="flex-1 flex items-center justify-between">
                                <div class="flex-1">
                                    <h4 class="font-bold text-xs uppercase">${ex.n}</h4>
                                    <input type="text" value="${ex.obs || ''}" oninput="workoutData.days['${dayKey}'][${idx}].obs=this.value;save()" class="w-full bg-transparent border-b border-dashed text-[10px] outline-none mt-1" placeholder="Obs..." ${isStudent ? 'disabled' : ''}>
                                    <div class="flex gap-2 mt-2 no-print admin-ui">
                                        <button onclick="toggleBi('${dayKey}', ${idx})" class="text-[8px] font-bold px-2 py-1 rounded-full ${ex.bi ? 'bg-pink-hot text-white' : 'bg-slate-100 dark:bg-slate-800'}">CONJUGAR</button>
                                        <button onclick="removeEx('${dayKey}', ${idx})" class="text-[8px] font-bold px-2 py-1 bg-red-500/10 text-red-500 rounded-full">REMOVER</button>
                                    </div>
                                </div>
                                <div class="flex gap-2 ml-4">
                                    <div class="text-center">
                                        <p class="text-[7px] uppercase font-bold opacity-40">S√©ries</p>
                                        <input type="text" value="${ex.r}" oninput="workoutData.days['${dayKey}'][${idx}].r=this.value;save()" class="w-12 bg-slate-100 dark:bg-slate-800 text-center text-[10px] font-bold p-2 rounded-lg" ${isStudent ? 'disabled' : ''}>
                                    </div>
                                    <div class="text-center">
                                        <p class="text-[7px] uppercase font-bold opacity-40">Carga</p>
                                        <input type="text" value="${ex.w}" oninput="workoutData.days['${dayKey}'][${idx}].w=this.value;save()" class="w-10 bg-slate-100 dark:bg-slate-800 text-center text-[10px] font-bold p-2 rounded-lg" ${isStudent ? 'disabled' : ''}>
                                    </div>
                                </div>
                            </div>
                        </div>
                        ${checklistHtml}
                    </div>`;
                });
                container.innerHTML += html + `</div></div>`;
            });
        }

        function renderLibrary() {
            const container = document.getElementById('accordionLib');
            container.innerHTML = "";
            Object.keys(exerciseLibrary).forEach(cat => {
                container.innerHTML += `
                    <div class="border border-slate-200 dark:border-slate-800 rounded-xl overflow-hidden mb-2">
                        <button onclick="this.nextElementSibling.classList.toggle('active')" class="w-full p-3 text-left bg-slate-50 dark:bg-slate-800 text-[10px] font-black uppercase flex justify-between items-center">
                            ${cat} <span>‚ñº</span>
                        </button>
                        <div class="category-content p-2 space-y-1 bg-white dark:bg-slate-900">
                            ${exerciseLibrary[cat].map(ex => `
                                <div onclick="addEx('${ex}', this)" class="p-2 text-[11px] hover:bg-pink-hot/10 cursor-pointer rounded-lg flex justify-between items-center group">
                                    <span>${ex}</span>
                                    <span class="text-pink-hot font-bold opacity-0 group-hover:opacity-100">+ ADD</span>
                                </div>`).join('')}
                        </div>
                    </div>`;
            });
        }

        function toggleBi(day, idx) { workoutData.days[day][idx].bi = !workoutData.days[day][idx].bi; save(); render(); }
        function duplicateDay(from) {
            const to = prompt("Copiar para (ex: terca)");
            if(to && workoutData.days[to.toLowerCase()]) { workoutData.days[to.toLowerCase()] = JSON.parse(JSON.stringify(workoutData.days[from])); save(); render(); }
        }
        function save() { if(!document.body.classList.contains('is-student-mode')) { workoutData.student = document.getElementById('studentName').value; workoutData.generalNotes = document.getElementById('generalNotes').value; localStorage.setItem('jaque_final_v1', JSON.stringify(workoutData)); } }
        function loadFromStorage() { const s = localStorage.getItem('jaque_final_v1'); if(s) workoutData = JSON.parse(s); }
        function toggleTheme() { document.documentElement.classList.toggle('dark'); }
        function removeEx(d, i) { workoutData.days[d].splice(i, 1); save(); render(); }
        function updateHeader() { document.getElementById('studentDisplayHead').innerText = `ALUNO: ${document.getElementById('studentName').value}`; save(); }
        function clearAll() { if(confirm("Limpar tudo?")) { localStorage.clear(); location.reload(); } }

        function getFullURL() {
            const json = JSON.stringify(workoutData);
            const enc = btoa(encodeURIComponent(json).replace(/%([0-9A-F]{2})/g, (m, p) => String.fromCharCode('0x' + p)));
            return `${window.location.origin}${window.location.pathname}?aluno=${enc}`;
        }

        function generateLink() { navigator.clipboard.writeText(getFullURL()); alert("Link Copiado!"); }
        function shortenLinkWithName() {
            const longUrl = encodeURIComponent(getFullURL());
            window.open(`https://abre.ai/index.php?a=shorten&url=${longUrl}`, '_blank');
        }

        function sendWhatsApp() {
            const url = getFullURL();
            window.open(`https://api.whatsapp.com/send?text=Fala ${workoutData.student}, segue seu treino: ${url}`, '_blank');
        }

        document.getElementById('searchEx').addEventListener('input', function(e) {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('#accordionLib .category-content').forEach(cat => {
                let hasMatch = false;
                cat.querySelectorAll('div').forEach(el => {
                    const match = el.innerText.toLowerCase().includes(term);
                    el.style.display = match ? 'flex' : 'none';
                    if(match) hasMatch = true;
                });
                if(term.length > 1 && hasMatch) cat.classList.add('active');
                else if(term.length <= 1) cat.classList.remove('active');
            });
        });

        window.onload = init;
    </script>
</body>
</html>
